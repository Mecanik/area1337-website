---
import BaseLayout from "../layouts/BaseLayout.astro";
import { COMPANY_EMAIL, COMPANY_SUPPORT_EMAIL, COMPANY_NAME } from "../consts";
---

<BaseLayout
  title="Contact"
  description={`Get in touch with ${COMPANY_NAME}. Request a demo, discuss pricing, or reach our support team for V1337 Registry.`}
>

  <section class="contact-hero section--dark">
    <div class="container text-center">
      <div class="animate-fade-in-up">
        <span class="badge badge--dark">Contact</span>
        <h1 style="margin-top: var(--space-md);">Let's talk</h1>
        <p class="contact-hero__subtitle">
          Whether you're evaluating V1337 Registry, need pricing information, or have a support question, we're here to help.
        </p>
      </div>
    </div>
  </section>

  <section class="contact-section">
    <div class="container">
      <div class="contact-grid">

        <div class="contact-form-wrapper">
          <h2>Send us a message</h2>
          <p style="margin-bottom: var(--space-xl);">Fill out the form and our team will get back to you within 1 business day.</p>

          <form class="contact-form" id="contact-form" novalidate>
            <div class="form-row">
              <div class="form-group">
                <label for="first-name">First name <span class="required">*</span></label>
                <input type="text" id="first-name" name="firstName" required autocomplete="given-name" />
              </div>
              <div class="form-group">
                <label for="last-name">Last name <span class="required">*</span></label>
                <input type="text" id="last-name" name="lastName" required autocomplete="family-name" />
              </div>
            </div>

            <div class="form-group">
              <label for="email">Work email <span class="required">*</span></label>
              <input type="email" id="email" name="email" required autocomplete="email" />
            </div>

            <div class="form-group">
              <label for="company">Company name</label>
              <input type="text" id="company" name="company" autocomplete="organization" />
            </div>

            <div class="form-group">
              <label for="subject">Subject <span class="required">*</span></label>
              <select id="subject" name="subject" required>
                <option value="" disabled selected>Select a topic</option>
                <option value="demo">Request a Demo</option>
                <option value="pricing">Pricing Enquiry</option>
                <option value="enterprise">Enterprise Edition</option>
                <option value="support">Technical Support</option>
                <option value="partnership">Partnership</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div class="form-group">
              <label for="message">Message <span class="required">*</span></label>
              <textarea id="message" name="message" rows="5" required placeholder="Tell us about your compliance needs..."></textarea>
            </div>

            <button type="submit" class="btn btn--primary btn--lg" style="width: 100%;">
              Send Message
            </button>

            <p class="form-disclaimer">
              By submitting this form, you agree to our <a href="/privacy">Privacy Policy</a>.
            </p>
          </form>
        </div>

        <div class="contact-info">

          <div class="contact-info__card">
            <div class="contact-info__icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
            </div>
            <h3>Sales & Enquiries</h3>
            <a href={`mailto:${COMPANY_EMAIL}`}>{COMPANY_EMAIL}</a>
            <p>For demos, pricing, and partnership discussions.</p>
          </div>

          <div class="contact-info__card">
            <div class="contact-info__icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
            </div>
            <h3>Technical Support</h3>
            <a href={`mailto:${COMPANY_SUPPORT_EMAIL}`}>{COMPANY_SUPPORT_EMAIL}</a>
            <p>For existing customers with technical questions.</p>
          </div>

          <div class="contact-info__card">
            <div class="contact-info__icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            </div>
            <h3>Response Time</h3>
            <p style="font-weight: 600; color: var(--color-text); margin-bottom: 0.25rem;">Within 1 business day</p>
            <p>We aim to respond to all enquiries promptly.</p>
          </div>

        </div>
      </div>
    </div>
  </section>

</BaseLayout>

<style>
  .contact-hero {
    padding: var(--space-4xl) 0 var(--space-2xl);
    background: linear-gradient(135deg, var(--color-primary) 0%, #1a2744 100%);
  }
  .contact-hero__subtitle {
    max-width: 520px;
    margin: var(--space-md) auto 0;
    color: var(--color-text-muted);
    font-size: 1.125rem;
  }

  .contact-section {
    padding: var(--space-4xl) 0 var(--space-5xl);
  }

  .contact-grid {
    display: grid;
    grid-template-columns: 1.2fr 0.8fr;
    gap: var(--space-3xl);
    align-items: start;
  }

  /* Form styles */
  .contact-form-wrapper h2 {
    font-size: 1.5rem;
  }

  .contact-form {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-lg);
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }

  .form-group label {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-text);
  }

  .required {
    color: var(--color-error);
  }

  .form-group input,
  .form-group select,
  .form-group textarea {
    padding: 0.75rem 1rem;
    border: 1.5px solid var(--color-border);
    border-radius: var(--radius-md);
    font-size: 0.9375rem;
    color: var(--color-text);
    background: var(--color-white);
    transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: var(--color-accent);
    box-shadow: 0 0 0 3px var(--color-accent-light);
  }

  .form-group textarea {
    resize: vertical;
    min-height: 120px;
  }

  .form-group select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    padding-right: 2.5rem;
  }

  .form-disclaimer {
    font-size: 0.8125rem;
    color: var(--color-text-muted);
    text-align: center;
    margin: 0;
  }

  .form-disclaimer a {
    color: var(--color-accent);
  }

  /* Contact info sidebar */
  .contact-info {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
  }

  .contact-info__card {
    background: var(--color-border-light);
    border-radius: var(--radius-lg);
    padding: var(--space-xl);
  }

  .contact-info__icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    border-radius: var(--radius-md);
    background: var(--color-accent-light);
    color: var(--color-accent);
    margin-bottom: var(--space-md);
  }

  .contact-info__card h3 {
    font-size: 1rem;
    margin-bottom: var(--space-xs);
  }

  .contact-info__card a {
    font-size: 0.9375rem;
    color: var(--color-accent);
    display: block;
    margin-bottom: var(--space-sm);
  }

  .contact-info__card p {
    font-size: 0.8125rem;
    color: var(--color-text-muted);
    margin: 0;
    line-height: 1.5;
  }

  @media (max-width: 768px) {
    .contact-grid {
      grid-template-columns: 1fr;
    }
    .form-row {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  const form = document.getElementById("contact-form") as HTMLFormElement;
  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const btn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
    const originalText = btn.textContent;
    btn.textContent = "Sending...";
    btn.disabled = true;

    const data = {
      firstName: (form.querySelector('[name="firstName"]') as HTMLInputElement).value,
      lastName: (form.querySelector('[name="lastName"]') as HTMLInputElement).value,
      email: (form.querySelector('[name="email"]') as HTMLInputElement).value,
      company: (form.querySelector('[name="company"]') as HTMLInputElement).value,
      subject: (form.querySelector('[name="subject"]') as HTMLSelectElement).value,
      message: (form.querySelector('[name="message"]') as HTMLTextAreaElement).value,
    };

    try {
      const res = await fetch("/api/contact", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      const result = await res.json();

      if (res.ok && result.success) {
        btn.textContent = "Message Sent!";
        btn.style.backgroundColor = "var(--color-success)";
        form.reset();
        setTimeout(() => {
          btn.textContent = originalText;
          btn.style.backgroundColor = "";
          btn.disabled = false;
        }, 4000);
      } else {
        btn.textContent = result.error || "Something went wrong";
        btn.style.backgroundColor = "var(--color-danger, #dc3545)";
        setTimeout(() => {
          btn.textContent = originalText;
          btn.style.backgroundColor = "";
          btn.disabled = false;
        }, 4000);
      }
    } catch {
      btn.textContent = "Network error. Please try again.";
      btn.style.backgroundColor = "var(--color-danger, #dc3545)";
      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.backgroundColor = "";
        btn.disabled = false;
      }, 4000);
    }
  });
</script>
